webpackJsonp([3],{156:function(t,e,n){"use strict";function o(t){if(t&&D.enableTypefiles?!E:E){var e=t.substr(t.lastIndexOf(".")+1);e=e.toLowerCase();for(var n=0;n<j.length;n++)if(e===j[n]||R)return!0}}function a(){for(var t in T){var e=T[t].aria2;e&&e.socket&&1===e.socket.readyState&&T[t].aria2.close()}T={},window.s2a.aria2Connects=T,window.s2a.config=D,D.rpcList.forEach(function(t,e){var n=t.url.match(/^(http|ws)(s)?(?:\:\/\/)(token\:[^@]*)?@?([^\:\/]*)\:?(\d*)(\/[^\/]*)/),o={host:n[4],port:n[5]||6800,secure:!(!n||!n[2]),secret:n[3]?n[3].split(":")[1]:"",path:n[6]||"/jsonrpc"},a=new O.Aria2(o);T[t.url]={aria2:a,rpc:t,push:t.push},t.push&&(M&&clearTimeout(M),i(T[t.url],t.name))})}function i(t,e,n){t.aria2.open().then(function(){s(t,e),n&&_.success(["成功开启",e,"推送服务"])}).catch(function(o){!n&&_.error(["请确认aria2已经运行,每隔10秒后将会自动重试"],[e,"开启推送失败"]),M=setTimeout(function(){i(t,e,!0)},1e4)})}function s(t,e){var n=t.aria2,o=function(t){},a=function(t,e){r(n,t.gid).then(function(t){_.show(e?"error":"success",[t,"下载",e?"失败":"成功"])})};n.onDownloadStart=o,n.onDownloadComplete=a,n.onBtDownloadComplete=a,n.onDownloadError=function(t){a(t,!0)}}function r(t,e){return t.tellStatus(e,["bittorrent"]).then(function(n){return t.getFiles(e).then(function(t){return{files:t,bt:n}})}).then(function(t){var e=t.files[0].path,n=e.split("/").pop();return t.bt&&t.bt.info?bt.bittorrent.info.name:n}).catch(function(t){_.error(["获取任务信息失败"])})}function c(t){var e=T[t[0].url],n=!!e&&e.aria2,o=D.enableCookie?"Cookie: "+t[3]:"";D.baidupanAutoDisableCookie&&t[2]&&t[2].match(/^https\:\/\/pan\.baidu\.com\/s/)&&(o=""),n&&t[1]&&n.addUri([t[1]],{header:o,timeout:10,"content-disposition-default-utf8":!0,"user-agent":D.userAgent}).then(function(){_.success(["成功添加至",e.rpc.name,D.enableCookie?"":"(关闭cookie)"])}).catch(function(t){_.error(["添加至",e.rpc.name,"失败",D.enableCookie?"":"(关闭cookie)"]),console.log(t)})}function l(t){"showOptions"===t.key&&u()}function u(){safari.application.activeBrowserWindow.openTab().url=safari.extension.baseURI+"options.html"}function f(){D=localStorage.getItem("safari2aria");try{D=JSON.parse(D||"{}")}catch(t){D={defaultRpcIndex:0}}j=D.filetypes?D.filetypes.split(" "):[];for(var t=0;t<j.length;t++)j[t]=j[t].toLowerCase();P=D.rpcList,d("receiveConfig",D),a(),A()(safari,"extension.popovers[0].contentWindow.tlwin.refreshServerList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshServerList()}function p(t){W[t.name]&&W[t.name](t.message,t)}function d(t,e,n){e instanceof Function&&(n=e,e={}),n&&(e=b()(e||{},{hasCb:!0}),W[t+"_cb"]=n),safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(t,e)}function h(t){var e=t.keyPressed||{};if(E=e[91],R=e[16],L=e[18],R&&L){for(var n=49;n<=57&&n-49<P.length;n++)if(e[n]){D.defaultRpcIndex=n-49,p({name:"updateSafari2Aria",message:D}),d("changeRpc",P[D.defaultRpcIndex].name);break}e[192]&&d("currentRpc",P[D.defaultRpcIndex].name),e[188]&&u()}}function m(t){if("showOptions"===t.command)u();else{var e=t.command.split(".")[1];c([e&&P[e]?P[e]:P[0]].concat(t.userInfo))}}function v(t){var e=t.command&&t.command.match(/^DownloadWithAria2/);if(e&&e.length>=0){var n=t.userInfo;n&&n.length&&n[0]||(t.target.disabled=!0)}}function g(t){o(t.url)&&(t.preventDefault(),d("getCookie",function(e){c([P[D.defaultRpcIndex],t.url,t.target.url,e.cookie])}))}function w(t){P.forEach(function(e,n){t.contextMenu.appendContextMenuItem(["DownloadWithAria2",n].join("."),["下载至",e.name].join(""))})}Object.defineProperty(e,"__esModule",{value:!0});var y=n(18),b=n.n(y),k=n(36),x=n.n(k),S=n(113),A=n.n(S),C=n(112),I=n.n(C),O=n(35),D={defaultRpcIndex:0},E=void 0,R=void 0,L=void 0,j=[],P=[],T={},M=void 0,W={updateSafari2Aria:function(t){localStorage.setItem("safari2aria",x()(t)),f()},keyPress:function(t){h(t)},getConfig:function(){d("receiveConfig",D)},downloadFromIframe:function(t,e){if(o(t.url)){c([P[D.defaultRpcIndex],t.url,e.target.url,t.cookie])}}},_={success:function(t,e){_.show("success",t,e)},error:function(t,e){_.show("error",t,e)},show:function(t,e,n){e instanceof Array&&(e=e.join("")),n instanceof Array&&(n=n.join("")),d("showMassage",{action:t||"success",text:e,title:n})}};window.s2a={aria2Connects:T,config:D,changeServer:function(t){var e=void 0;I()(P,function(n,o){n.url===t&&(e=o)}),D.defaultRpcIndex=e,p({name:"updateSafari2Aria",message:D}),d("changeRpc",P[D.defaultRpcIndex].name)},openOptions:u,getConfig:function(){window.s2a.aria2Connects=T,window.s2a.config=D}},document.addEventListener("DOMContentLoaded",f),safari.application.addEventListener("message",p,!1),safari.extension.settings.addEventListener("change",l,!1),safari.application.addEventListener("command",m,!1),safari.application.addEventListener("validate",v,!1),safari.application.addEventListener("beforeNavigate",g,!1),safari.application.addEventListener("contextmenu",w,!1)},35:function(t,e,n){"use strict";(function(t){var e=n(36),o=n.n(e),a=n(20),i=n.n(a),s=n(118),r=n.n(s),c=n(140),l=n.n(c);!function(e){var n=void 0!==t&&t.exports,a=function t(e){this.callbacks=r()(null),this.lastId=0;for(var n in t.options)this[n]="object"===(void 0===e?"undefined":i()(e))&&n in e?e[n]:t.options[n]};a.prototype.http=function(t,e){var n=this,a={method:t.method,id:t.id};Array.isArray(t.params)&&t.params.length>0&&(a.params=t.params);var i="http"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path;fetch(i,{method:"POST",body:o()(a),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){n._onmessage(t)}).catch(e)},a.prototype.send=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof e[e.length-1]?e.pop():null;return this.exec(t,e,n)},a.prototype.exec=function(t,e,n){if("string"!=typeof t)throw new TypeError(t+" is not a string");0!==t.indexOf("system.")&&0!==t.indexOf("aria2.")&&(t="aria2."+t);var a={method:t,"json-rpc":"2.0",id:this.lastId++},i=this.secret?["token:"+this.secret]:[];Array.isArray(e)&&("system.multicall"===t?(Array.isArray(e[0])&&e[0].forEach(function(t){t.params||(t.params=[]),t.params=i.concat(t.params)}),i=e):i=i.concat(e)),i.length>0&&(a.params=i),this.onsend(a);var s=this;return this.socket&&1===this.socket.readyState?this.socket.send(o()(a)):this.http(a,function(t){s.callbacks[a.id](t),delete s.callbacks[a.id]}),l()(function(t){s.callbacks[a.id]=t},n)},a.prototype._onmessage=function(t){if(this.onmessage(t),void 0!==t.id){var e=this.callbacks[t.id];e&&(t.error?e(t.error):e(null,t.result),delete this.callbacks[t.id])}else if(t.method){var n=t.method.split("aria2.")[1];0===n.indexOf("on")&&"function"==typeof this[n]&&a.notifications.indexOf(n)>-1&&this[n].apply(this,t.params)}},a.prototype.open=function(t){var e="ws"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path,n=this.socket=new WebSocket(e),o=this,a=!1;return n.onmessage=function(t){o._onmessage(JSON.parse(t.data))},l()(function(t){n.onopen=function(){a||(t(),a=!0),o.onopen()},n.onclose=function(e){o.onclose(),1006==e.code&&(a||(t(e),a=!0))},n.onerror=function(e){a||(t(e),a=!0)}},t)},a.prototype.close=function(t){var e=this.socket;return l()(function(t){e?(e.addEventListener("close",function(){t()}),e.close()):t()},t)},a.methods=["addUri","addTorrent","addMetalink","remove","forceRemove","pause","pauseAll","forcePause","forcePauseAll","unpause","unpauseAll","tellStatus","getUris","getFiles","getPeers","getServers","tellActive","tellWaiting","tellStopped","changePosition","changeUri","getOption","changeOption","getGlobalOption","changeGlobalOption","getGlobalStat","purgeDownloadResult","removeDownloadResult","getVersion","getSessionInfo","shutdown","forceShutdown","saveSession","system.multicall","system.listMethods","system.listNotifications"],a.notifications=["onDownloadStart","onDownloadPause","onDownloadStop","onDownloadComplete","onDownloadError","onBtDownloadComplete"],a.events=["onopen","onclose","onsend","onmessage"],a.options={secure:!1,host:"localhost",port:6800,secret:"",path:"/jsonrpc"},a.methods.forEach(function(t){var e=t.indexOf(".")>-1?t.split(".")[1]:t;a.prototype[e]=function(){return this.send.apply(this,[t].concat(Array.prototype.slice.call(arguments)))}}),a.notifications.forEach(function(t){a.prototype[t]=function(){}}),a.events.forEach(function(t){a.prototype[t]=function(){}}),n?t.exports=a:e.Aria2=a}(this)}).call(e,n(145)(t))}},[156]);