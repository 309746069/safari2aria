webpackJsonp([3],{157:function(e,t,n){"use strict";function o(e){if(e&&E.enableTypefiles?!L:L){var t=e.substr(e.lastIndexOf(".")+1);t=t.toLowerCase();for(var n=0;n<T.length;n++)if(t===T[n]||R)return!0}}function a(){for(var e in W){var t=W[e].aria2;t&&t.socket&&1===t.socket.readyState&&W[e].aria2.close()}W={},E.rpcList.forEach(function(e,t){var n=e.url.match(/^(http|ws)(s)?(?:\:\/\/)(token\:[^@]*)?@?([^\:\/]*)\:?(\d*)(\/[^\/]*)/),o={host:n[4],port:n[5]||6800,secure:!(!n||!n[2]),secret:n[3]?n[3].split(":")[1]:"",path:n[6]||"/jsonrpc"},a=new O.Aria2(o);W[e.url]={aria2:a,rpc:e,push:e.push},e.push&&(M&&clearTimeout(M),i(W[e.url],e.name))}),window.s2a.aria2Connects=W,window.s2a.config=E}function i(e,t){e.aria2.open().then(function(){r(e,t),e.reconnect&&(delete e.reconnect,B.success(["成功链接",t]))}).catch(function(n){e.reconnect&&B.error(["请确认aria2已经运行,每隔10秒将会自动重试"],[t,"链接失败"]),e.reconnect=!0,M=setTimeout(function(){i(e,t)},1e4)})}function s(){C()(safari,"extension.popovers[0].contentWindow.tlwin.refreshTaskList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshTaskList()}function r(e,t){var n=e.aria2,o=function(e){s()},a=function(e){s()},i=function(e,t){s(),c(n,e.gid).then(function(e){B.show(t?"error":"success",[e,"下载",t?"失败":"成功"])})};n.onDownloadStart=o,n.onDownloadPause=a,n.onDownloadStop=a,n.onDownloadComplete=i,n.onBtDownloadComplete=i,n.onDownloadError=function(e){i(e,!0)}}function c(e,t){return e.tellStatus(t,["bittorrent"]).then(function(n){return e.getFiles(t).then(function(e){return{files:e,bt:n}})}).then(function(e){var t=e.files[0].path,n=t.split("/").pop();return e.bt&&e.bt.info?bt.bittorrent.info.name:n}).catch(function(e){B.error(["获取任务信息失败"])})}function f(e){var t=W[e[0].url],n=!!t&&t.aria2,o=E.enableCookie?"Cookie: "+e[3]:"";n&&e[1]&&n.addUri([e[1]],{header:o,timeout:10,"content-disposition-default-utf8":!0,"user-agent":E.userAgent}).then(function(){B.success(["成功添加至",t.rpc.name,E.enableCookie?"":"(关闭cookie)"])}).catch(function(e){B.error(["添加至",t.rpc.name,"失败",E.enableCookie?"":"(关闭cookie)"]),console.log(e)})}function l(e){"showOptions"===e.key&&u()}function u(){safari.application.activeBrowserWindow.openTab().url=safari.extension.baseURI+"options.html"}function p(){E=localStorage.getItem("safari2aria");try{E=JSON.parse(E||"{}")}catch(e){E={defaultRpcIndex:0}}T=E.filetypes?E.filetypes.split(" "):[];for(var e=0;e<T.length;e++)T[e]=T[e].toLowerCase();P=E.rpcList,h("receiveConfig",E),a(),C()(safari,"extension.popovers[0].contentWindow.tlwin.refreshServerList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshServerList()}function d(e){_[e.name]&&_[e.name](e.message,e)}function h(e,t,n){t instanceof Function&&(n=t,t={}),n&&(t=k()(t||{},{hasCb:!0}),_[e+"_cb"]=n),window.safari&&safari.application.activeBrowserWindow.activeTab.page&&safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(e,t)}function m(e){var t=e.keyPressed||{};if(L=t[91],R=t[16],j=t[18],R&&j){for(var n=49;n<=57&&n-49<P.length;n++)if(t[n]){E.defaultRpcIndex=n-49,d({name:"updateSafari2Aria",message:E}),h("changeRpc",P[E.defaultRpcIndex].name);break}t[192]&&h("currentRpc",P[E.defaultRpcIndex].name),t[188]&&u(),t[76]&&safari&&safari.extension&&safari.extension.toolbarItems[0].showPopover()}}function v(e){if("showOptions"===e.command)u();else{var t=e.command.split(".")[1];f([t&&P[t]?P[t]:P[0]].concat(e.userInfo))}}function g(e){var t=e.command&&e.command.match(/^DownloadWithAria2/);if(t&&t.length>=0){var n=e.userInfo;n&&n.length&&n[0]||(e.target.disabled=!0)}}function w(e){o(e.url)&&(e.preventDefault(),h("getCookie",function(t){f([P[E.defaultRpcIndex],e.url,e.target.url,t.cookie])}))}function y(e){P.forEach(function(t,n){e.contextMenu.appendContextMenuItem(["DownloadWithAria2",n].join("."),["下载至",t.name].join(""))})}Object.defineProperty(t,"__esModule",{value:!0});var b=n(18),k=n.n(b),x=n(35),S=n.n(x),A=n(113),C=n.n(A),I=n(56),D=n.n(I),O=n(55),E={defaultRpcIndex:0},L=void 0,R=void 0,j=void 0,T=[],P=[],W={},M=void 0,_={updateSafari2Aria:function(e){localStorage.setItem("safari2aria",S()(e)),p()},keyPress:function(e){m(e)},getConfig:function(){h("receiveConfig",E)},downloadFromIframe:function(e,t){if(o(e.url)){f([P[E.defaultRpcIndex],e.url,t.target.url,e.cookie])}}},B={success:function(e,t){B.show("success",e,t)},error:function(e,t){B.show("error",e,t)},show:function(e,t,n){t instanceof Array&&(t=t.join("")),n instanceof Array&&(n=n.join("")),h("showMassage",{action:e||"success",text:t,title:n})}};window.s2a={aria2Connects:W,config:E,changeServer:function(e){var t=void 0;D()(P,function(n,o){n.url===e&&(t=o)}),E.defaultRpcIndex=t,d({name:"updateSafari2Aria",message:E})},openOptions:u,getConfig:function(){window.s2a.aria2Connects=W,window.s2a.config=E}},document.addEventListener("DOMContentLoaded",p),safari.application.addEventListener("message",d,!1),safari.extension.settings.addEventListener("change",l,!1),safari.application.addEventListener("command",v,!1),safari.application.addEventListener("validate",g,!1),safari.application.addEventListener("beforeNavigate",w,!1),safari.application.addEventListener("contextmenu",y,!1)},55:function(e,t,n){"use strict";(function(e){var t=n(35),o=n.n(t),a=n(20),i=n.n(a),s=n(118),r=n.n(s),c=n(140),f=n.n(c);!function(t){var n=void 0!==e&&e.exports,a=function e(t){this.callbacks=r()(null),this.lastId=0;for(var n in e.options)this[n]="object"===(void 0===t?"undefined":i()(t))&&n in t?t[n]:e.options[n]};a.prototype.http=function(e,t){var n=this,a={method:e.method,id:e.id};Array.isArray(e.params)&&e.params.length>0&&(a.params=e.params);var i="http"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path;fetch(i,{method:"POST",body:o()(a),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){n._onmessage(e)}).catch(t)},a.prototype.send=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"==typeof t[t.length-1]?t.pop():null;return this.exec(e,t,n)},a.prototype.exec=function(e,t,n){if("string"!=typeof e)throw new TypeError(e+" is not a string");0!==e.indexOf("system.")&&0!==e.indexOf("aria2.")&&(e="aria2."+e);var a={method:e,"json-rpc":"2.0",id:this.lastId++},i=this.secret?["token:"+this.secret]:[];Array.isArray(t)&&("system.multicall"===e?(Array.isArray(t[0])&&t[0].forEach(function(e){e.params||(e.params=[]),e.params=i.concat(e.params)}),i=t):i=i.concat(t)),i.length>0&&(a.params=i),this.onsend(a);var s=this;return this.socket&&1===this.socket.readyState?this.socket.send(o()(a)):this.http(a,function(e){s.callbacks[a.id](e),delete s.callbacks[a.id]}),f()(function(e){s.callbacks[a.id]=e},n)},a.prototype._onmessage=function(e){if(this.onmessage(e),void 0!==e.id){var t=this.callbacks[e.id];t&&(e.error?t(e.error):t(null,e.result),delete this.callbacks[e.id])}else if(e.method){var n=e.method.split("aria2.")[1];0===n.indexOf("on")&&"function"==typeof this[n]&&a.notifications.indexOf(n)>-1&&this[n].apply(this,e.params)}},a.prototype.open=function(e){var t="ws"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path,n=this.socket=new WebSocket(t),o=this,a=!1;return n.onmessage=function(e){o._onmessage(JSON.parse(e.data))},f()(function(e){n.onopen=function(){a||(e(),a=!0),o.onopen()},n.onclose=function(t){o.onclose(),1006==t.code&&(a||(e(t),a=!0))},n.onerror=function(t){a||(e(t),a=!0)}},e)},a.prototype.close=function(e){var t=this.socket;return f()(function(e){t?(t.addEventListener("close",function(){e()}),t.close()):e()},e)},a.methods=["addUri","addTorrent","addMetalink","remove","forceRemove","pause","pauseAll","forcePause","forcePauseAll","unpause","unpauseAll","tellStatus","getUris","getFiles","getPeers","getServers","tellActive","tellWaiting","tellStopped","changePosition","changeUri","getOption","changeOption","getGlobalOption","changeGlobalOption","getGlobalStat","purgeDownloadResult","removeDownloadResult","getVersion","getSessionInfo","shutdown","forceShutdown","saveSession","system.multicall","system.listMethods","system.listNotifications"],a.notifications=["onDownloadStart","onDownloadPause","onDownloadStop","onDownloadComplete","onDownloadError","onBtDownloadComplete"],a.events=["onopen","onclose","onsend","onmessage"],a.options={secure:!1,host:"localhost",port:6800,secret:"",path:"/jsonrpc"},a.methods.forEach(function(e){var t=e.indexOf(".")>-1?e.split(".")[1]:e;a.prototype[t]=function(){return this.send.apply(this,[e].concat(Array.prototype.slice.call(arguments)))}}),a.notifications.forEach(function(e){a.prototype[e]=function(){}}),a.events.forEach(function(e){a.prototype[e]=function(){}}),n?e.exports=a:t.Aria2=a}(this)}).call(t,n(145)(e))}},[157]);